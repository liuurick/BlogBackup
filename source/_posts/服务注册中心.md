---
title: 服务注册中心
date: 2020-08-15 21:42:31
tags: [Eureka,Zookeeper,Consul,Nacos]
categories: [应用框架,后端,分布式/微服务]
---

[TOC]

# Eureka

## Eureka基础知识

### 什么是服务治理

SpringCloud封装了Netflix公司开发的Eureka模块来实现服务治理

在传统的rpc远程调用框架中，管理每个服务与服务之间的依赖关系比较复杂，管理比较复杂，所以需要使用服务治理管理服务之间的依赖关系，可以实现服务调用，负载均衡，容错等，实现服务注册与发行。

### 什么是服务注册

​		Eureka采用了CS的设计架构，Eureka Server作为服务注册功能的服务器,它是服务注册中心。而系统中的其他微服务，使用Eureka的客户端连接到Eureka Server并维持心跳连接。这样系统的维护人员就可以通过Eureka Server来监控系统中各个微服务是否正常运行。
​		在服务注册与发现中，有一个注册中心。当服务器启动的时候， 会把当前自己服务器的信息比如服务地址通讯地址等以别名方式注册到注册中心上。另一方(消费者|服务提供者)，以该别名的方式去注册中心上获取到实际的服务通讯地址，然后再实现本地RPC调用RPC远程调用框架核心设计思想:在于注册中心，因为使用注册中心管理每个服务与服务之间的一个依赖关系(服务治理概念)。在任何rpc远程框架中，都会有一个注册中心(存放服务地址相关信息(接口地址))

![image-20210105201422163](/images/2021010501.png)

### Eureka两组件

Eureka包含两大组件：**Eureka Server**和**Eureka Client**

![img](/images/2021010502.png)

## 单机Eureka构建步骤

单机Eureka构建主要分为三步：

1.IDEA生成eurekaServer端服务注册中心类似物业公司

- 建module

  cloud-eureka-server7001

- 改pom

  ```xml
      <dependencies>
          <!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server -->
          <dependency>
              <groupId>org.springframework.cloud</groupId>
              <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
          </dependency>
  
          <dependency>
              <groupId>com.atguigu.springcloud</groupId>
              <artifactId>cloud-api-commons</artifactId>
              <version>${project.version}</version>
          </dependency>
  
          <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web -->
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-web</artifactId>
          </dependency>
  
          <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web  -->
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-actuator</artifactId>
          </dependency>
  
          <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools -->
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-devtools</artifactId>
              <scope>runtime</scope>
              <optional>true</optional>
          </dependency>
  
          <!-- https://mvnrepository.com/artifact/org.projectlombok/lombok -->
          <dependency>
              <groupId>org.projectlombok</groupId>
              <artifactId>lombok</artifactId>
          </dependency>
  
          <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test -->
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-test</artifactId>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>junit</groupId>
              <artifactId>junit</artifactId>
          </dependency>
  
      </dependencies>
  ```

- 写yml

```yml
server:
  port: 7001

eureka:
  instance:
    hostname: localhost  #eureka服务端的实例名字
  client:
    register-with-eureka: false    #表识不向注册中心注册自己
    fetch-registry: false   #表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务
    service-url:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/    #设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址
```

- 主启动

```java
@SpringBootApplication
@EnableEurekaServer
public class EurekaMain7001 {
    public static void main(String[] args) {
        SpringApplication.run(EurekaMain7001.class,args);
    }
}
```

- 测试:http://localhost:7001/



2.EurekaClient端cloud-provider-payment8001将注册进EurekaServer成为服务提供者provider，类似学校对外提供授课服务

- 建module

  cloud-provider-payment8001

- 改pom

  ```xml
  <dependency>
     <groupId>org.springframework.cloud</groupId>
     <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
  </dependency>
  ```

- 写yml

  ```yml
  eureka:
    client:
      register-with-eureka: true
      fetchRegistry: true
      service-url:
        defaultZone: http://localhost:7001/eureka
   
  ```

  

- 主启动

  ```java
  import org.springframework.boot.SpringApplication;
  import org.springframework.boot.autoconfigure.SpringBootApplication;
  import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
  
  @EnableEurekaClient
  @SpringBootApplication
  public class PaymentMain8001 {
      public static void main(String[] args) {
          SpringApplication.run(PaymentMain8001.class,args);
      }
  }
  ```

- 测试

- 自我保护机制

  

**注意：**微服务注册名配置说明

![image-20210105202130247](/images/2021010503.png)



3.EurekaClient端cloud-consumer-order80将注册进EurekaServer成为服务消费者consumer,类似来上课消费的各位同学

- 建module

  cloud-consumer-order80

- 改pom

  ```xml
  <dependency>
  	<groupId>org.springframework.cloud</groupId>
  	<artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
  </dependency>
  ```

- 写yml

  ```yml
  spring:
    application:
      name: cloud-order-service
  
  eureka:
    client:
      register-with-eureka: true
      fetchRegistry: true
      service-url:
        defaultZone: http://localhost:7001/eureka
  ```

- 主启动

  ```java
  import org.springframework.boot.SpringApplication;
  import org.springframework.boot.autoconfigure.SpringBootApplication;
  import org.springframework.cloud.netflix.eureka.EnableEurekaClient;
  
  @EnableEurekaClient
  @SpringBootApplication
  public class PaymentMain8001 {
      public static void main(String[] args) {
          SpringApplication.run(PaymentMain8001.class,args);
      }
  }
  ```

  

- 测试



## 集群Eureka构建步骤

### 集群说明

![image-20210105202441280](/images/2021010504.png)

### EurekaServer集群环境构建步骤

- 建module

- 改pom

- 修改映射配置

- 改yml

- 主启动

## actuator微服务信息完善

主机名称：服务名称修改

```
instance:
    instance-id: payment8001
```



访问信息有ip信息提示

```
prefer-ip-address: true
```

## 服务发现Discovery

对于注册进eureka里面的微服务，可以通过服务发现来获得该服务的信息

## Eureka自我保护



# Zookeeper





# Consul



# Nacos

