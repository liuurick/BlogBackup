---
title: 微服务架构编码构建
date: 2020-08-15 18:57:16
tags: SpringCloud
categories: [应用框架,后端,分布式/微服务]
---

[TOC]

<!--more-->

# 微服务架构编码构建

> 约定 > 配置 > 编码

## IDEA新建project工作空间

### 微服务cloud整体聚合父工程Project

1. New Project

   ![image-20210101203755207](/images/2021010102.png)

2. 聚合总工程名字

3. Maven选版本

4. 工程名字

5. 字符编码

   File->Settings->File Encodings->全部设置为UTF-8

6. 注解生效激活

   File->Settings->Annotation Processors

   ![image-20210101204204572](/images/2021010103.png)

7. Java编译版本选择

   ![image-20210101204339548](/images/2021010104.png)

8. File Type过滤

   ```
   *.hprof;*.idea;*.iml;*.pyc;*.pyo;*.rbc;*.yarb;*~;.DS_Store;.git;.hg;.svn;CVS;__pycache__;_svn;vssver.scc;vssver2.scc;
   ```

   ![image-20210101204718998](/images/2021010105.png)

### 父工程POM



**注意：**

```
解决maven下载不了jar的问题请复制这个链接到浏览器自行解决：
https://blog.csdn.net/HeyWeCome/article/details/104543411
```



**Maven中的dependencyManagement和dependencies**

​		使用dependencyManagement统一管理项目的版本号，确保应用的各个项目的依赖和版本一致，才能保证测试的和发布的是相同的成果，因此，在顶层pom中定义共同的依赖关系。同时可以避免在每个使用的子项目中都声明一个版本号，这样想升级或者切换到另一个版本时，只需要在父类容器里更新，不需要任何一个子项目的修改。

​		如果某个子项目需要另外一个版本号时，只需要在dependencies中声明一个版本号即可。子类就会使用子类声明的版本号，不继承于父类版本号。



maven中跳过单元测试

![image-20210102104537833](/images/2021010106.png)

父工程创建完成执行mvn:install将父工程发布到仓库方便子工程继承

## Rest微服务工程构建

对于子模块的创建主要分为以下几步：

1. 创建mode
2. 改POM文件
3. 写YML
4. 主启动
5. 业务类
6. 测试



**构建步骤如下：**

### 1.cloud-provider-payment8001微服务提供者支付Module模块

#### 建cloud-provider-payment8001

创建完成后请回到父工程查看pom文件变化



#### 改POM文件

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>cloud2020</artifactId>
        <groupId>com.liuurick.springcloud</groupId>
        <version>1.0-SNAPSHOT</version>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>cloud-provider-payment8001</artifactId>

    <dependencies>
        <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>

        <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web -->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
        </dependency>

        <!-- https://mvnrepository.com/artifact/com.alibaba/druid -->
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-starter</artifactId>
            <version>1.1.10</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>

        <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-jdbc -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-jdbc</artifactId>
        </dependency>

        <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
           <scope>runtime</scope>
            <optional>true</optional>
        </dependency>

        <!-- https://mvnrepository.com/artifact/org.projectlombok/lombok -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
</project>
```



#### 写yml

```yml
server:
  port: 8001


spring:
  application:
    name: cloud-payment-service
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: org.gjt.mm.mysql.Driver
    url: jdbc:mysql://localhost:3306/db2020?useUnicode=true&characterEncoding=utf-8&useSSL=false
    username: root
    password: 123456

mybatis:
  mapperLocations: classpath:mapper/*.xml
  type-aliases-package: com.atguigu.springcloud.entities
```



#### 主启动

```java
@SpringBootApplication
public class xxx {
    public static void main(String[] args) {
        SpringApplication.run(xxx.class,args);
    }
}
```



#### 业务类

业务类主要有以下几步：

1. 建表
2. entity
3. dao
4. service
5. controller

#### 测试

可以使用postman

### 2.热部署Devtools

热部署功能的导入主要有以下几步：

引入依赖

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
   <scope>runtime</scope>
    <optional>true</optional>
</dependency>
```

配置父工程pom

```xml
<build>
  <plugins>
    <plugin>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-maven-plugin</artifactId>
      <configuration>
        <fork>true</fork>
        <addResources>true</addResources>
      </configuration>
    </plugin>
  </plugins>
</build>
```



开启自动构建

![image-20210101210359900](/images/2021010101.png)



update the value of

快捷键 `ctrl+shift+alt+/`，然后选择Registry

![image-20210102105046131](/images/2021010107.png)

![image-20210102105307801](/images/2021010108.png)



最后重启IDEA



### 3.cloud-consumer-order80微服务消费者订单Module模块









### 4.工程重构

在创建多个子mode的时候，会出现重复部分，此时就需要重构

重构的步骤也比较简单，主要有以下几步：

1. 新建cloud-api-common
2. pom
3. entity
4. maven clean、install
5. 改造模块